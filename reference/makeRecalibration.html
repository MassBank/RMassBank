<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Recalibrate MS/MS spectra — makeRecalibration • RMassBank</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Recalibrate MS/MS spectra — makeRecalibration"><meta property="og:description" content="Recalibrates MS/MS spectra by building a recalibration curve of the
assigned putative fragments of all spectra in aggregatedSpecs
(measured mass vs. mass of putative associated fragment) and additionally
the parent ion peaks."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RMassBank</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.15.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/RMassBank.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/RMassBankNonstandard.html">RMassBank: Non-standard usage</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Recalibrate MS/MS spectra</h1>
    
    <div class="hidden name"><code>makeRecalibration.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Recalibrates MS/MS spectra by building a recalibration curve of the
assigned putative fragments of all spectra in <code>aggregatedSpecs</code>
(measured mass vs. mass of putative associated fragment) and additionally
the parent ion peaks.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">makeRecalibration</span><span class="op">(</span><span class="va">w</span>,  </span>
<span>   recalibrateBy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">recalibrateBy</span>,</span>
<span>    recalibrateMS1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">recalibrateMS1</span>,</span>
<span>    recalibrator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">recalibrator</span>,</span>
<span>    recalibrateMS1Window <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">recalibrateMS1Window</span> </span>
<span>    <span class="op">)</span></span>
<span></span>
<span> <span class="fu">recalibrateSpectra</span><span class="op">(</span>rawspec <span class="op">=</span> <span class="cn">NULL</span>, rc <span class="op">=</span> <span class="cn">NULL</span>, rc.ms1<span class="op">=</span><span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    recalibrateBy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">recalibrateBy</span>,</span>
<span>    recalibrateMS1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">recalibrateMS1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span> <span class="fu">recalibrateSingleSpec</span><span class="op">(</span><span class="va">spectrum</span>, <span class="va">rc</span>, </span>
<span>    recalibrateBy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">recalibrateBy</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt id="arg-w">w<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>For <code>makeRecalibration</code>: to perform the recalibration with. For <code>recalibrateSpectra</code>: 
the <code>msmsWorkspace</code> which contains the recalibration curves (alternatively to specifying <code>rc, rc.ms1</code>).</p></dd>


<dt id="arg-recalibrateby">recalibrateBy<a class="anchor" aria-label="anchor" href="#arg-recalibrateby"></a></dt>
<dd><p>Whether recalibration should be done by ppm ("ppm") or by m/z ("mz").</p></dd>


<dt id="arg-recalibratems-">recalibrateMS1<a class="anchor" aria-label="anchor" href="#arg-recalibratems-"></a></dt>
<dd><p>Whether MS1 spectra should be recalibrated separately ("separate"),
together with MS2 ("common") or not at all ("none"). Usually taken from settings.</p></dd>


<dt id="arg-recalibrator">recalibrator<a class="anchor" aria-label="anchor" href="#arg-recalibrator"></a></dt>
<dd><p>The recalibrator functions to be used.
Refer to <code><a href="recalibrate.html">recalibrate</a></code> for details. Usually taken from settings.</p></dd>


<dt id="arg-recalibratems-window">recalibrateMS1Window<a class="anchor" aria-label="anchor" href="#arg-recalibratems-window"></a></dt>
<dd><p>Window width to look for MS1 peaks to recalibrate (in ppm).</p></dd>


<dt id="arg-spectrum">spectrum<a class="anchor" aria-label="anchor" href="#arg-spectrum"></a></dt>
<dd><p>For <code>recalibrateSingleSpec</code>:
a <code>MSnbase</code> <code>Spectrum</code>-derived object, commonly a <code>RmbSpectrum2</code> for MS2 or <code>Spectrum1</code> for MS1.</p></dd>


<dt id="arg-rawspec">rawspec<a class="anchor" aria-label="anchor" href="#arg-rawspec"></a></dt>
<dd><p>For <code>recalibrateSpectra</code>:an <code>RmbSpectraSetList</code> of <code>RmbSpectraSet</code> objects
, as the <code>w@spectra</code> slot from <code>msmsWorkspace</code> or any object returned by <code><a href="findMsMsHR.html">findMsMsHR</a></code>.
If empty, no spectra are recalibrated, but the recalibration curve is
returned.</p></dd>


<dt id="arg-rc-rc-ms-">rc, rc.ms1<a class="anchor" aria-label="anchor" href="#arg-rc-rc-ms-"></a></dt>
<dd><p>The recalibration curves to be used in the recalibration.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>makeRecalibration</code>: a <code>list(rc, rc.ms1)</code> with recalibration curves
			for the MS2 and MS1 spectra.</p>
<p></p>
<p><code>recalibrateSpectra</code>: if <code>rawspec</code> is not <code>NULL</code>, returns the recalibrated
			spectra as <code>RmbSpectraSetList</code>. All spectra have their mass recalibrated and evaluation data deleted.</p>
<p></p>
<p><code>recalibrateSingleSpec</code>: the recalibrated <code>Spectrum</code> (same object, recalibrated masses,
				 evaluation data like assigned formulae etc. deleted).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Note that the actually used recalibration functions are governed by the
general MassBank settings (see <code><a href="recalibrate.html">recalibrate</a></code>).</p>
<p>If a set of acquired LC-MS runs contains spectra for two different ion types
(e.g. [M+H]+ and [M+Na]+) which should both be processed by RMassBank, it is
necessary to do this in two separate runs. Since it is likely that one ion type
will be the vast majority of spectra (e.g. most in [M+H]+ mode), and only few
spectra will be present for other specific adducts (e.g. only few [M+Na]+ spectra),
it is possible that too few spectra are present to build a good recalibration curve
using only e.g. the [M+Na]+ ions. Therefore we recommend, for one set of LC/MS runs,
to build the recalibration curve for one ion type 
(<code>msmsWorkflow(mode="pH", steps=c(1:8), newRecalibration=TRUE)</code>)
and reuse the same curve for processing different ion types 
(<code>msmsWorkflow(mode="pNa", steps=c(1:8), newRecalibration=FALSE)</code>).
This also ensures a consistent recalibration across all spectra of the same batch.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Michael Stravs, Eawag &lt;michael.stravs@eawag.ch&gt;</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> </span></span>
<span class="r-in"><span>      <span class="va">rcCurve</span> <span class="op">&lt;-</span> <span class="fu">recalibrateSpectra</span><span class="op">(</span><span class="va">w</span>, <span class="st">"pH"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">w</span><span class="op">@</span><span class="va">spectra</span> <span class="op">&lt;-</span> <span class="fu">recalibrateSpectra</span><span class="op">(</span>mode<span class="op">=</span><span class="st">"pH"</span>, rawspec<span class="op">=</span><span class="va">w</span><span class="op">@</span><span class="va">spectra</span>, w<span class="op">=</span><span class="va">myWorkspace</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="va">w</span><span class="op">@</span><span class="va">spectra</span> <span class="op">&lt;-</span> <span class="fu">recalibrateSpectra</span><span class="op">(</span>mode<span class="op">=</span><span class="st">"pH"</span>, rawspec<span class="op">=</span><span class="va">w</span><span class="op">@</span><span class="va">spectra</span>,  <span class="va">rcCurve</span><span class="op">$</span><span class="va">rc</span>, <span class="va">rcCurve</span><span class="op">$</span><span class="va">rc.ms1</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by RMassBank at Eawag, Michael A. Stravs, Emma L. Schymanski, Steffen Neumann, Erik Muller, Paul Stahlhofen, Tobias Schulze.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

