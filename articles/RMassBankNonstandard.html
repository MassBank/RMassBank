<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RMassBank: Non-standard usage • RMassBank</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="RMassBank: Non-standard usage">
<meta property="og:description" content="RMassBank">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RMassBank</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.13.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/RMassBank.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/RMassBankNonstandard.html">RMassBank: Non-standard usage</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>RMassBank: Non-standard usage</h1>
                        <h4 data-toc-skip class="author">Michael
Stravs</h4>
            
      
      
      <div class="hidden name"><code>RMassBankNonstandard.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<pre><code><span><span class="co">## Loading required package: Rcpp</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'gplots'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     lowess</span></span></code></pre>
<p>This vignette assumes you are familiar with the standard usage of
<em>RMassBank</em>, which is documented in</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="skipping-recalibration">Skipping recalibration<a class="anchor" aria-label="anchor" href="#skipping-recalibration"></a>
</h2>
<p>For instances where recalibration is not wanted, e.g. there is not
enough data, or the user wants to use non-recalibrated data,
recalibration can be deactivated. To do this, the
<code>recalibrator</code> entry in the settings must be set to
<code>recalibrate.identity</code>. This can be done in the settings file
directly (preferred):</p>
<pre><code><span><span class="va">recalibrator</span><span class="op">:</span></span>
<span>    <span class="va">MS1</span><span class="op">:</span> <span class="va">recalibrate.identity</span></span>
<span>    <span class="va">MS2</span><span class="op">:</span> <span class="va">recalibrate.identity</span></span></code></pre>
<p>Or, alternatively, the settings can be adapted directly via R
code.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/RmbDefaultSettings.html">RmbDefaultSettings</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">rmbo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span></span>
<span><span class="va">rmbo</span><span class="op">$</span><span class="va">recalibrator</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"MS1"</span> <span class="op">=</span> <span class="st">"recalibrate.identity"</span>,</span>
<span>        <span class="st">"MS2"</span> <span class="op">=</span> <span class="st">"recalibrate.identity"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"RMassBank"</span> <span class="op">=</span> <span class="va">rmbo</span><span class="op">)</span></span></code></pre></div>
<p>To show the results of using a non-recalibrated workflow, we load a
workspace with pre-processed data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newMsmsWorkspace.html">loadMsmsWorkspace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"results/pH_narcotics_RF.RData"</span>, </span>
<span>                package<span class="op">=</span><span class="st">"RMassBankData"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in .updateObject.RmbWorkspace.1to2(w, ..., verbose): You are</span></span>
<span><span class="co">## loading an archive from an old RMassBank version. The aggregate tables</span></span>
<span><span class="co">## are not loaded from the original object, but recomputed.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in .updateObject.RmbWorkspace.1to2(w, ..., verbose): If you</span></span>
<span><span class="co">## hand-edited any aggregate table, the information might not be retained in</span></span>
<span><span class="co">## the new object.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in .updateObject.RmbWorkspace.1to2(w, ..., verbose): You are</span></span>
<span><span class="co">## loading an archive from an old RMassBank version. The aggregate tables</span></span>
<span><span class="co">## are not loaded from the original object, but recomputed.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in .updateObject.RmbWorkspace.1to2(w, ..., verbose): If you</span></span>
<span><span class="co">## hand-edited any aggregate table, the information might not be retained in</span></span>
<span><span class="co">## the new object.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in .updateObject.RmbWorkspace.1to2(w, ..., verbose): You are</span></span>
<span><span class="co">## loading an archive from an old RMassBank version. The multiplicity</span></span>
<span><span class="co">## filtering results are not loaded from the original object, but</span></span>
<span><span class="co">## recomputed.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in .updateObject.RmbWorkspace.1to2(w, ..., verbose): If you</span></span>
<span><span class="co">## hand-edited any multiplicity filtering results, the information might not</span></span>
<span><span class="co">## be retained in the new object.</span></span></code></pre>
<p>The recalibration curve:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeRecalibration.html">makeRecalibration</a></span><span class="op">(</span><span class="va">w</span><span class="op">@</span><span class="va">parent</span>,</span>
<span>                recalibrateBy <span class="op">=</span> <span class="va">rmbo</span><span class="op">$</span><span class="va">recalibrateBy</span>,</span>
<span>                recalibrateMS1 <span class="op">=</span> <span class="va">rmbo</span><span class="op">$</span><span class="va">recalibrateMS1</span>,</span>
<span>                recalibrator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>MS1<span class="op">=</span><span class="st">"recalibrate.loess"</span>,MS2<span class="op">=</span><span class="st">"recalibrate.loess"</span><span class="op">)</span>,</span>
<span>                recalibrateMS1Window <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<p><img src="RMassBankNonstandard_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span><span class="op">@</span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="va">recal</span><span class="op">$</span><span class="va">rc</span></span>
<span><span class="va">w</span><span class="op">@</span><span class="va">rc.ms1</span> <span class="op">&lt;-</span> <span class="va">recal</span><span class="op">$</span><span class="va">rc.ms1</span></span>
<span><span class="va">w</span><span class="op">@</span><span class="va">parent</span> <span class="op">&lt;-</span> <span class="va">w</span></span>
<span><span class="fu"><a href="../reference/plotRecalibration.html">plotRecalibration</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span></code></pre></div>
<p><img src="RMassBankNonstandard_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>Some example peaks to show the effect of recalibration:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span><span class="op">@</span><span class="va">spectra</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">parent</span><span class="op">@</span><span class="va">mz</span><span class="op">[</span><span class="fl">30</span><span class="op">:</span><span class="fl">32</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 133.0346 133.0381 133.9772</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span><span class="op">@</span><span class="va">spectra</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">mz</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">17</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 87.00286 88.13592 97.10767</span></span></code></pre>
<p>Now reprocess the recalibration step with the above set
<code>recalibration.identity</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmsWorkflow.html">msmsWorkflow</a></span><span class="op">(</span><span class="va">w</span>, steps<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>The recalibration graph shows that the recalibration “curve” will do
no recalibration. To verify, we can show the same peaks as before:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span><span class="op">@</span><span class="va">spectra</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">parent</span><span class="op">@</span><span class="va">mz</span><span class="op">[</span><span class="fl">30</span><span class="op">:</span><span class="fl">32</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 133.0346 133.0381 133.9772</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span><span class="op">@</span><span class="va">spectra</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">children</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">mz</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">17</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 87.00286 88.13592 97.10767</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="combining-multiplicities">Combining multiplicities<a class="anchor" aria-label="anchor" href="#combining-multiplicities"></a>
</h2>
<p>Standard multiplicity filtering, which is configurable in the
settings, eliminates peaks which are observed only once for a compound.
This eliminates spurious formula matches for random noise efficiently.
It works well if either many spectra are recorded per compound, or if
the same collision energy is present twice (e.g. with different
resolutions). It sometimes fails for spectra on the “outer end” of the
recorded collision energies when that spectrum is only present once –
peaks which appear only in the highest or only in the lowest recorded
energy can be erroneously deleted. To prevent this, one can re-run the
workflow, read a second set of spectra for every compound (the second
most intense) and combine the peak multiplicities of the two analyzed
runs. (Mutiplicity filtering can also be switched off completely.)</p>
<p>Example:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/RmbDefaultSettings.html">RmbDefaultSettings</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span><span class="op">$</span><span class="va">multiplicityFilter</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to make processing faster, we only use 3 spectra per compound</span></span>
<span><span class="va">rmbo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"RMassBank"</span><span class="op">)</span></span>
<span><span class="va">rmbo</span><span class="op">$</span><span class="va">spectraList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"CID"</span>, ces <span class="op">=</span> <span class="st">"35%"</span>, ce <span class="op">=</span> <span class="st">"35 % (nominal)"</span>, res <span class="op">=</span> <span class="fl">7500</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"HCD"</span>, ces <span class="op">=</span> <span class="st">"15%"</span>, ce <span class="op">=</span> <span class="st">"15 % (nominal)"</span>, res <span class="op">=</span> <span class="fl">7500</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">"HCD"</span>, ces <span class="op">=</span> <span class="st">"30%"</span>, ce <span class="op">=</span> <span class="st">"30 % (nominal)"</span>, res <span class="op">=</span> <span class="fl">7500</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>RMassBank <span class="op">=</span> <span class="va">rmbo</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/loadList.html">loadList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"list/NarcoticsDataset.csv"</span>, </span>
<span>        package<span class="op">=</span><span class="st">"RMassBankData"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newMsmsWorkspace.html">newMsmsWorkspace</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"spectra"</span>, package<span class="op">=</span><span class="st">"RMassBankData"</span><span class="op">)</span>,</span>
<span>        <span class="st">".mzML"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">w</span><span class="op">@</span><span class="va">files</span> <span class="op">&lt;-</span> <span class="va">files</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<p>First, the spectra are read and processed until reanalysis (step 7)
normally:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmsWorkflow.html">msmsWorkflow</a></span><span class="op">(</span><span class="va">w</span>, mode<span class="op">=</span><span class="st">"pH"</span>, steps<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Here we artificially cut spectra out to make the workflow run faster for the vignette:</span></span>
<span><span class="va">w1</span><span class="op">@</span><span class="va">spectra</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">w1</span><span class="op">@</span><span class="va">spectra</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span>    <span class="op">{</span></span>
<span>        <span class="va">s</span><span class="op">@</span><span class="va">children</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">@</span><span class="va">children</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span>        <span class="va">s</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,<span class="st">"SimpleList"</span><span class="op">)</span></span>
<span><span class="va">w1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmsWorkflow.html">msmsWorkflow</a></span><span class="op">(</span><span class="va">w1</span>, mode<span class="op">=</span><span class="st">"pH"</span>, steps<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="RMassBankNonstandard_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Subsequently, we re-read and process the “confirmation spectra”,
i.e. the second-best spectra from the files. Therefore, we will have two
sets of spectra for each compound and every real peak should in theory
occur twice.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmsWorkflow.html">msmsWorkflow</a></span><span class="op">(</span><span class="va">w</span>, mode<span class="op">=</span><span class="st">"pH"</span>, steps<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, confirmMode <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># Here we artificially cut spectra out to make the workflow run faster for the vignette:</span></span>
<span></span>
<span><span class="va">w2</span><span class="op">@</span><span class="va">spectra</span> <span class="op">&lt;-</span> <span class="fu">as</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">w2</span><span class="op">@</span><span class="va">spectra</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span>    <span class="op">{</span></span>
<span>        <span class="va">s</span><span class="op">@</span><span class="va">children</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">@</span><span class="va">children</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span>        <span class="va">s</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,<span class="st">"SimpleList"</span><span class="op">)</span></span>
<span><span class="va">w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmsWorkflow.html">msmsWorkflow</a></span><span class="op">(</span><span class="va">w2</span>, mode<span class="op">=</span><span class="st">"pH"</span>, steps<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="RMassBankNonstandard_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Finally, we combine the two workspaces for multiplicity filtering,
and apply the last step in the workflow (multiplicity filtering).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wTotal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combineMultiplicities.html">combineMultiplicities</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">w1</span>, <span class="va">w2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">wTotal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/msmsWorkflow.html">msmsWorkflow</a></span><span class="op">(</span><span class="va">wTotal</span>, steps<span class="op">=</span><span class="fl">8</span>, mode<span class="op">=</span><span class="st">"pH"</span>, archivename <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span></span></code></pre></div>
<p>Subsequently, we can proceed as usual with
<code>mbWorkflow</code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newMbWorkspace.html">newMbWorkspace</a></span><span class="op">(</span><span class="va">wTotal</span><span class="op">)</span></span>
<span><span class="co"># [...] load lists, execute workflow etc.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.1 (2023-06-16)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8          LC_NUMERIC=C                 </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8           LC_COLLATE=en_US.UTF-8       </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8       LC_MESSAGES=en_US.UTF-8      </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8          LC_NAME=en_US.UTF-8          </span></span>
<span><span class="co">##  [9] LC_ADDRESS=en_US.UTF-8        LC_TELEPHONE=en_US.UTF-8     </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8    LC_IDENTIFICATION=en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] gplots_3.1.3         RMassBankData_1.38.0 RMassBank_3.13.1    </span></span>
<span><span class="co">## [4] Rcpp_1.0.11          BiocStyle_2.28.1    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] DBI_1.1.3             rcdklibs_2.8          bitops_1.0-7         </span></span>
<span><span class="co">##   [4] gridExtra_2.3         logger_0.2.2          rlang_1.1.1          </span></span>
<span><span class="co">##   [7] magrittr_2.0.3        clue_0.3-65           compiler_4.3.1       </span></span>
<span><span class="co">##  [10] png_0.1-8             systemfonts_1.0.5     vctrs_0.6.4          </span></span>
<span><span class="co">##  [13] rvest_1.0.3           stringr_1.5.0         ProtGenerics_1.35.4  </span></span>
<span><span class="co">##  [16] pkgconfig_2.0.3       fastmap_1.1.1         caTools_1.18.2       </span></span>
<span><span class="co">##  [19] readJDX_0.6.1         utf8_1.2.4            rmarkdown_2.25       </span></span>
<span><span class="co">##  [22] preprocessCore_1.62.1 itertools_0.1-3       ragg_1.2.6           </span></span>
<span><span class="co">##  [25] purrr_1.0.2           xfun_0.40             zlibbioc_1.46.0      </span></span>
<span><span class="co">##  [28] cachem_1.0.8          ChemmineR_3.52.0      jsonlite_1.8.7       </span></span>
<span><span class="co">##  [31] BiocParallel_1.34.2   data.tree_1.1.0       parallel_4.3.1       </span></span>
<span><span class="co">##  [34] cluster_2.1.4         R6_2.5.1              bslib_0.5.1          </span></span>
<span><span class="co">##  [37] stringi_1.7.12        limma_3.56.2          jquerylib_0.1.4      </span></span>
<span><span class="co">##  [40] bookdown_0.36         assertthat_0.2.1      iterators_1.0.14     </span></span>
<span><span class="co">##  [43] knitr_1.44            base64enc_0.1-3       R.utils_2.12.3       </span></span>
<span><span class="co">##  [46] IRanges_2.34.1        tidyselect_1.2.0      rcdk_3.8.1           </span></span>
<span><span class="co">##  [49] yaml_2.3.7            doParallel_1.0.17     codetools_0.2-19     </span></span>
<span><span class="co">##  [52] affy_1.78.2           lattice_0.22-5        tibble_3.2.1         </span></span>
<span><span class="co">##  [55] plyr_1.8.9            Biobase_2.60.0        evaluate_0.22        </span></span>
<span><span class="co">##  [58] desc_1.4.2            rJava_1.0-6           xml2_1.3.5           </span></span>
<span><span class="co">##  [61] pillar_1.9.0          affyio_1.70.0         BiocManager_1.30.22  </span></span>
<span><span class="co">##  [64] KernSmooth_2.23-22    DT_0.30               foreach_1.5.2        </span></span>
<span><span class="co">##  [67] stats4_4.3.1          MSnbase_2.26.0        MALDIquant_1.22.1    </span></span>
<span><span class="co">##  [70] ncdf4_1.21            generics_0.1.3        rprojroot_2.0.3      </span></span>
<span><span class="co">##  [73] RCurl_1.98-1.13       S4Vectors_0.38.2      ggplot2_3.4.4        </span></span>
<span><span class="co">##  [76] munsell_0.5.0         scales_1.2.1          gtools_3.9.4         </span></span>
<span><span class="co">##  [79] glue_1.6.2            webchem_1.3.0         tools_4.3.1          </span></span>
<span><span class="co">##  [82] data.table_1.14.8     mzID_1.38.0           vsn_3.68.0           </span></span>
<span><span class="co">##  [85] mzR_2.37.3            fs_1.6.3              XML_3.99-0.15        </span></span>
<span><span class="co">##  [88] grid_4.3.1            impute_1.74.1         fingerprint_3.5.7    </span></span>
<span><span class="co">##  [91] MsCoreUtils_1.15.7    colorspace_2.1-0      cli_3.6.1            </span></span>
<span><span class="co">##  [94] textshaping_0.3.7     rsvg_2.6.0            fansi_1.0.5          </span></span>
<span><span class="co">##  [97] dplyr_1.1.3           pcaMethods_1.92.0     gtable_0.3.4         </span></span>
<span><span class="co">## [100] R.methodsS3_1.8.2     sass_0.4.7            digest_0.6.33        </span></span>
<span><span class="co">## [103] BiocGenerics_0.46.0   rjson_0.2.21          htmlwidgets_1.6.2    </span></span>
<span><span class="co">## [106] memoise_2.0.1         htmltools_0.5.6.1     pkgdown_2.0.9.9000   </span></span>
<span><span class="co">## [109] R.oo_1.25.0           lifecycle_1.0.3       httr_1.4.7           </span></span>
<span><span class="co">## [112] MASS_7.3-60</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by RMassBank at Eawag, Michael A. Stravs, Emma L. Schymanski, Steffen Neumann, Erik Muller, Paul Stahlhofen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
